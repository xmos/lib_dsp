// Copyright (c) 2016, XMOS Ltd, All rights reserved
// XMOS DSP Library - Upsample by factor of 3 example
// Uses Signed 32b Integer format

// Include files
#include <stdio.h>
#include <xs1.h>
#include <dsp.h>
#include <stdint.h>

#define NUM_CHANNELS  2
#define NUM_OUTPUT_SAMPLES  384

// 0db 1KHz 16KHz sinewave - pure tone test
const int32_t s1k_0db_16[1024] = {0, 820984395, 1516981307, 1982031665, 2145335552, 1982031537, 1516981179, 820984203, -187, -820984587, -1516981435, -1982031665, -2145335552, -1982031537, -1516981051, -820984075, 375, 820984715, 1516981563, 1982031793, 2145335552, 1982031409, 1516980923, 820983883, -562, -820984907, -1516981691, -1982031793, -2145335552, -1982031409, -1516980795, -820983691, 750, 820985099, 1516981819, 1982031921, 2145335552, 1982031281, 1516980667, 820983499, -937, -820985291, -1516982075, -1982032049, -2145335552, -1982031153, -1516980539, -820983371, 1125, 820985419, 1516982203, 1982032049, 2145335552, 1982031153, 1516980411, 820983179, -1312, -820985611, -1516982331, -1982032177, -2145335552, -1982031025, -1516980283, -820982987, 1500, 820985803, 1516982459, 1982032177, 2145335552, 1982031025, 1516980155, 820982859, -1687, -820985931, -1516982587, -1982032305, -2145335552, -1982030897, -1516980027, -820982667, 1875, 820986123, 1516982715, 1982032305, 2145335552, 1982030897, 1516979899, 820982475, -2063, -820986315, -1516982843, -1982032433, -2145335552, -1982030769, -1516979771, -820982283, 2250, 820986443, 1516982971, 1982032433, 2145335552, 1982030641, 1516979643, 820982155, -2438, -820986635, -1516983099, -1982032561, -2145335552, -1982030641, -1516979515, -820981963, 2625, 820986827, 1516983227, 1982032689, 2145335552, 1982030513, 1516979387, 820981771, -2813, -820987019, -1516983355, -1982032689, -2145335552, -1982030513, -1516979259, -820981643, 3000, 820987147, 1516983483, 1982032817, 2145335552, 1982030385, 1516979131, 820981451, -3188, -820987339, -1516983611, -1982032817, -2145335552, -1982030385, -1516979003, -820981259, 3375, 820987531, 1516983739, 1982032945, 2145335552, 1982030257, 1516978875, 820981131, -3563, -820987659, -1516983867, -1982032945, -2145335552, -1982030257, -1516978747, -820980939, 3751, 820987851, 1516983995, 1982033073, 2145335552, 1982030129, 1516978619, 820980747, -3938, -820988043, -1516984123, -1982033201, -2145335552, -1982030001, -1516978491, -820980555, 4126, 820988235, 1516984251, 1982033201, 2145335552, 1982030001, 1516978363, 820980427, -4313, -820988363, -1516984379, -1982033329, -2145335552, -1982029873, -1516978107, -820980235, 4501, 820988555, 1516984507, 1982033329, 2145335552, 1982029873, 1516977979, 820980043, -4688, -820988747, -1516984635, -1982033457, -2145335552, -1982029745, -1516977851, -820979915, 4876, 820988875, 1516984763, 1982033457, 2145335552, 1982029745, 1516977723, 820979723, -5063, -820989067, -1516984891, -1982033585, -2145335552, -1982029617, -1516977595, -820979531, 5251, 820989259, 1516985019, 1982033585, 2145335552, 1982029489, 1516977467, 820979339, -5438, -820989451, -1516985147, -1982033713, -2145335552, -1982029489, -1516977339, -820979211, 5626, 820989579, 1516985275, 1982033841, 2145335552, 1982029361, 1516977211, 820979019, -5814, -820989771, -1516985403, -1982033841, -2145335552, -1982029361, -1516977083, -820978827, 6001, 820989963, 1516985531, 1982033969, 2145335552, 1982029233, 1516976955, 820978699, -6189, -820990091, -1516985787, -1982033969, -2145335552, -1982029233, -1516976827, -820978507, 6376, 820990283, 1516985915, 1982034097, 2145335552, 1982029105, 1516976699, 820978315, -6564, -820990475, -1516986043, -1982034097, -2145335552, -1982029105, -1516976571, -820978187, 6751, 820990603, 1516986171, 1982034225, 2145335552, 1982028977, 1516976443, 820977995, -6939, -820990795, -1516986299, -1982034353, -2145335552, -1982028849, -1516976315, -820977803, 7126, 820990987, 1516986427, 1982034353, 2145335552, 1982028849, 1516976187, 820977611, -7314, -820991179, -1516986555, -1982034481, -2145335552, -1982028721, -1516976059, -820977483, 7502, 820991307, 1516986683, 1982034481, 2145335552, 1982028721, 1516975931, 820977291, -7689, -820991499, -1516986811, -1982034609, -2145335552, -1982028593, -1516975803, -820977099, 7877, 820991691, 1516986939, 1982034609, 2145335552, 1982028593, 1516975675, 820976971, -8064, -820991819, -1516987067, -1982034737, -2145335552, -1982028465, -1516975547, -820976779, 8252, 820992011, 1516987195, 1982034737, 2145335552, 1982028465, 1516975419, 820976587, -8439, -820992203, -1516987323, -1982034865, -2145335552, -1982028337, -1516975291, -820976395, 8627, 820992395, 1516987451, 1982034993, 2145335552, 1982028209, 1516975163, 820976267, -8814, -820992523, -1516987579, -1982034993, -2145335552, -1982028209, -1516975035, -820976075, 9002, 820992715, 1516987707, 1982035121, 2145335552, 1982028081, 1516974907, 820975883, -9190, -820992907, -1516987835, -1982035121, -2145335552, -1982028081, -1516974779, -820975755, 9377, 820993035, 1516987963, 1982035249, 2145335552, 1982027953, 1516974523, 820975563, -9565, -820993227, -1516988091, -1982035249, -2145335552, -1982027953, -1516974395, -820975371, 9752, 820993419, 1516988219, 1982035377, 2145335552, 1982027825, 1516974267, 820975179, -9940, -820993547, -1516988347, -1982035377, -2145335552, -1982027697, -1516974139, -820975051, 10127, 820993739, 1516988475, 1982035505, 2145335552, 1982027697, 1516974011, 820974859, -10315, -820993931, -1516988603, -1982035633, -2145335552, -1982027569, -1516973883, -820974667, 10502, 820994123, 1516988731, 1982035633, 2145335552, 1982027569, 1516973755, 820974539, -10690, -820994251, -1516988859, -1982035761, -2145335552, -1982027441, -1516973627, -820974347, 10877, 820994443, 1516988987, 1982035761, 2145335552, 1982027441, 1516973499, 820974155, -11065, -820994635, -1516989115, -1982035889, -2145335552, -1982027313, -1516973371, -820974027, 11253, 820994763, 1516989243, 1982035889, 2145335552, 1982027313, 1516973243, 820973835, -11440, -820994955, -1516989499, -1982036017, -2145335552, -1982027185, -1516973115, -820973643, 11628, 820995147, 1516989627, 1982036145, 2145335552, 1982027057, 1516972987, 820973451, -11815, -820995339, -1516989755, -1982036145, -2145335552, -1982027057, -1516972859, -820973323, 12003, 820995467, 1516989883, 1982036273, 2145335552, 1982026929, 1516972731, 820973131, -12190, -820995659, -1516990011, -1982036273, -2145335552, -1982026929, -1516972603, -820972939, 12378, 820995851, 1516990139, 1982036401, 2145335552, 1982026801, 1516972475, 820972811, -12565, -820995979, -1516990267, -1982036401, -2145335552, -1982026801, -1516972347, -820972619, 12753, 820996171, 1516990395, 1982036529, 2145335552, 1982026673, 1516972219, 820972427, -12941, -820996363, -1516990523, -1982036529, -2145335552, -1982026673, -1516972091, -820972235, 13128, 820996555, 1516990651, 1982036657, 2145335552, 1982026545, 1516971963, 820972107, -13316, -820996683, -1516990779, -1982036785, -2145335552, -1982026417, -1516971835, -820971915, 13503, 820996875, 1516990907, 1982036785, 2145335552, 1982026417, 1516971707, 820971723, -13691, -820997067, -1516991035, -1982036913, -2145335552, -1982026289, -1516971579, -820971595, 13878, 820997195, 1516991163, 1982036913, 2145335552, 1982026289, 1516971451, 820971403, -14066, -820997387, -1516991291, -1982037041, -2145335552, -1982026161, -1516971323, -820971211, 14253, 820997579, 1516991419, 1982037041, 2145335552, 1982026161, 1516971195, 820971083, -14441, -820997707, -1516991547, -1982037169, -2145335552, -1982026033, -1516971067, -820970891, 14628, 820997899, 1516991675, 1982037169, 2145335552, 1982025905, 1516970811, 820970699, -14816, -820998091, -1516991803, -1982037297, -2145335552, -1982025905, -1516970683, -820970507, 15004, 820998283, 1516991931, 1982037425, 2145335552, 1982025777, 1516970555, 820970379, -15191, -820998411, -1516992059, -1982037425, -2145335552, -1982025777, -1516970427, -820970187, 15379, 820998603, 1516992187, 1982037553, 2145335552, 1982025649, 1516970299, 820969995, -15566, -820998795, -1516992315, -1982037553, -2145335552, -1982025649, -1516970171, -820969867, 15754, 820998923, 1516992443, 1982037681, 2145335552, 1982025521, 1516970043, 820969675, -15941, -820999115, -1516992571, -1982037681, -2145335552, -1982025521, -1516969915, -820969483, 16129, 820999307, 1516992699, 1982037809, 2145335552, 1982025393, 1516969787, 820969291, -16316, -820999499, -1516992827, -1982037937, -2145335552, -1982025265, -1516969659, -820969163, 16504, 820999627, 1516993083, 1982037937, 2145335552, 1982025265, 1516969531, 820968971, -16692, -820999819, -1516993211, -1982038065, -2145335552, -1982025137, -1516969403, -820968779, 16879, 821000011, 1516993339, 1982038065, 2145335552, 1982025137, 1516969275, 820968651, -17067, -821000139, -1516993467, -1982038193, -2145335552, -1982025009, -1516969147, -820968459, 17254, 821000331, 1516993595, 1982038193, 2145335552, 1982025009, 1516969019, 820968267, -17442, -821000523, -1516993723, -1982038321, -2145335552, -1982024881, -1516968891, -820968075, 17629, 821000651, 1516993851, 1982038321, 2145335552, 1982024753, 1516968763, 820967947, -17817, -821000843, -1516993979, -1982038449, -2145335552, -1982024753, -1516968635, -820967755, 18004, 821001035, 1516994107, 1982038577, 2145335552, 1982024625, 1516968507, 820967563, -18192, -821001227, -1516994235, -1982038577, -2145335552, -1982024625, -1516968379, -820967435, 18380, 821001355, 1516994363, 1982038705, 2145335552, 1982024497, 1516968251, 820967243, -18567, -821001547, -1516994491, -1982038705, -2145335552, -1982024497, -1516968123, -820967051, 18755, 821001739, 1516994619, 1982038833, 2145335552, 1982024369, 1516967995, 820966923, -18942, -821001867, -1516994747, -1982038833, -2145335552, -1982024369, -1516967867, -820966731, 19130, 821002059, 1516994875, 1982038961, 2145335552, 1982024241, 1516967739, 820966539, -19317, -821002251, -1516995003, -1982039089, -2145335552, -1982024113, -1516967611, -820966347, 19505, 821002443, 1516995131, 1982039089, 2145335552, 1982024113, 1516967483, 820966219, -19692, -821002571, -1516995259, -1982039217, -2145335552, -1982023985, -1516967355, -820966027, 19880, 821002763, 1516995387, 1982039217, 2145335552, 1982023985, 1516967099, 820965835, -20067, -821002955, -1516995515, -1982039345, -2145335552, -1982023857, -1516966971, -820965707, 20255, 821003083, 1516995643, 1982039345, 2145335552, 1982023857, 1516966843, 820965515, -20443, -821003275, -1516995771, -1982039473, -2145335552, -1982023729, -1516966715, -820965323, 20630, 821003467, 1516995899, 1982039473, 2145335552, 1982023729, 1516966587, 820965131, -20818, -821003659, -1516996027, -1982039601, -2145335552, -1982023601, -1516966459, -820965003, 21005, 821003787, 1516996155, 1982039729, 2145335552, 1982023473, 1516966331, 820964811, -21193, -821003979, -1516996283, -1982039729, -2145335552, -1982023473, -1516966203, -820964619, 21380, 821004171, 1516996411, 1982039857, 2145335552, 1982023345, 1516966075, 820964491, -21568, -821004299, -1516996539, -1982039857, -2145335552, -1982023345, -1516965947, -820964299, 21755, 821004491, 1516996795, 1982039985, 2145335552, 1982023217, 1516965819, 820964107, -21943, -821004683, -1516996923, -1982039985, -2145335552, -1982023217, -1516965691, -820963979, 22131, 821004811, 1516997051, 1982040113, 2145335552, 1982023089, 1516965563, 820963787, -22318, -821005003, -1516997179, -1982040113, -2145335552, -1982022961, -1516965435, -820963595, 22506, 821005195, 1516997307, 1982040241, 2145335552, 1982022961, 1516965307, 820963403, -22693, -821005387, -1516997435, -1982040369, -2145335552, -1982022833, -1516965179, -820963275, 22881, 821005515, 1516997563, 1982040369, 2145335552, 1982022833, 1516965051, 820963083, -23068, -821005707, -1516997691, -1982040497, -2145335552, -1982022705, -1516964923, -820962891, 23256, 821005899, 1516997819, 1982040497, 2145335552, 1982022705, 1516964795, 820962763, -23443, -821006027, -1516997947, -1982040625, -2145335552, -1982022577, -1516964667, -820962571, 23631, 821006219, 1516998075, 1982040625, 2145335552, 1982022577, 1516964539, 820962379, -23819, -821006411, -1516998203, -1982040753, -2145335552, -1982022449, -1516964411, -820962187};
// -6db 4/5KHz 16KHz sinewaves - intermodulation test
const int32_t im4k5k_m6dB_16[1024] = {0, 1751257718, -1832991325, 348346744, 1073741504, -1170152739, 314491426, 232757770, 349, -232758042, -314491874, 1170153379, -1073741631, -348347224, 1832991709, -1751257590, -494, 1751257846, -1832990941, 348346232, 1073741376, -1170152227, 314491042, 232757450, 1049, -232758362, -314492322, 1170154019, -1073741631, -348347672, 1832992221, -1751257462, -989, 1751257974, -1832990429, 348345752, 1073741248, -1170151587, 314490594, 232757178, 1749, -232758698, -314492706, 1170154659, -1073741759, -348348152, 1832992605, -1751257206, -1484, 1751258102, -1832990045, 348345304, 1073741184, -1170150947, 314490210, 232756858, 2449, -232758954, -314493154, 1170155299, -1073741887, -348348664, 1832992989, -1751257078, -1979, 1751258358, -1832989661, 348344824, 1073741056, -1170150307, 314489762, 232756586, 3148, -232759290, -314493538, 1170155939, -1073742015, -348349144, 1832993373, -1751256950, -2474, 1751258486, -1832989149, 348344312, 1073740992, -1170149667, 314489314, 232756266, 3848, -232759546, -314493986, 1170156579, -1073742143, -348349592, 1832993885, -1751256694, -2969, 1751258614, -1832988765, 348343832, 1073740864, -1170149027, 314488930, 232755930, 4548, -232759882, -314494434, 1170157219, -1073742143, -348350072, 1832994269, -1751256694, -3464, 1751258870, -1832988381, 348343384, 1073740736, -1170148387, 314488482, 232755674, 5248, -232760138, -314494818, 1170157731, -1073742271, -348350584, 1832994653, -1751256438, -3958, 1751258998, -1832987997, 348342904, 1073740672, -1170147747, 314488098, 232755338, 5947, -232760474, -314495266, 1170158371, -1073742399, -348351032, 1832995165, -1751256310, -4453, 1751259126, -1832987485, 348342392, 1073740544, -1170147235, 314487650, 232755066, 6647, -232760794, -314495650, 1170159011, -1073742527, -348351512, 1832995549, -1751256182, -4948, 1751259254, -1832987101, 348341912, 1073740480, -1170146595, 314487202, 232754746, 7347, -232761066, -314496098, 1170159651, -1073742655, -348351992, 1832995933, -1751255926, -5443, 1751259382, -1832986717, 348341464, 1073740352, -1170145955, 314486818, 232754474, 8046, -232761402, -314496546, 1170160291, -1073742655, -348352472, 1832996445, -1751255798, -5938, 1751259638, -1832986205, 348340984, 1073740224, -1170145315, 314486370, 232754154, 8746, -232761658, -314496930, 1170160931, -1073742783, -348352952, 1832996829, -1751255670, -6433, 1751259766, -1832985821, 348340472, 1073740160, -1170144675, 314485986, 232753818, 9446, -232761994, -314497378, 1170161571, -1073742911, -348353432, 1832997213, -1751255542, -6928, 1751259894, -1832985437, 348340024, 1073740032, -1170144035, 314485538, 232753562, 10146, -232762250, -314497762, 1170162083, -1073743039, -348353912, 1832997597, -1751255414, -7423, 1751260022, -1832984925, 348339544, 1073739968, -1170143395, 314485090, 232753226, 10845, -232762586, -314498210, 1170162723, -1073743167, -348354392, 1832998109, -1751255286, -7917, 1751260278, -1832984541, 348339064, 1073739840, -1170142755, 314484706, 232752970, 11545, -232762906, -314498658, 1170163363, -1073743167, -348354872, 1832998493, -1751255030, -8412, 1751260278, -1832984157, 348338552, 1073739712, -1170142243, 314484258, 232752634, 12245, -232763178, -314499042, 1170164003, -1073743295, -348355352, 1832998877, -1751254902, -8907, 1751260534, -1832983773, 348338104, 1073739648, -1170141475, 314483874, 232752378, 12945, -232763498, -314499490, 1170164643, -1073743423, -348355832, 1832999389, -1751254774, -9402, 1751260662, -1832983261, 348337624, 1073739520, -1170140963, 314483426, 232752042, 13644, -232763770, -314499874, 1170165283, -1073743551, -348356312, 1832999773, -1751254518, -9897, 1751260790, -1832982877, 348337144, 1073739456, -1170140323, 314482978, 232751722, 14344, -232764090, -314500322, 1170165923, -1073743679, -348356792, 1833000157, -1751254390, -10392, 1751261046, -1832982493, 348336632, 1073739328, -1170139683, 314482594, 232751450, 15044, -232764362, -314500770, 1170166563, -1073743679, -348357272, 1833000669, -1751254262, -10887, 1751261174, -1832981981, 348336184, 1073739200, -1170139043, 314482146, 232751130, 15744, -232764682, -314501154, 1170167075, -1073743807, -348357752, 1833001053, -1751254134, -11382, 1751261302, -1832981597, 348335704, 1073739136, -1170138403, 314481762, 232750858, 16443, -232765018, -314501602, 1170167843, -1073743935, -348358232, 1833001437, -1751254006, -11876, 1751261430, -1832981213, 348335224, 1073739008, -1170137763, 314481314, 232750538, 17143, -232765274, -314501986, 1170168355, -1073744063, -348358712, 1833001821, -1751253750, -12371, 1751261558, -1832980701, 348334712, 1073738944, -1170137251, 314480866, 232750266, 17843, -232765610, -314502434, 1170168995, -1073744191, -348359192, 1833002333, -1751253622, -12866, 1751261814, -1832980317, 348334264, 1073738816, -1170136483, 314480482, 232749946, 18543, -232765866, -314502882, 1170169635, -1073744191, -348359672, 1833002717, -1751253494, -13361, 1751261942, -1832979933, 348333784, 1073738688, -1170135971, 314480034, 232749610, 19242, -232766202, -314503266, 1170170275, -1073744319, -348360120, 1833003101, -1751253366, -13856, 1751262070, -1832979549, 348333304, 1073738624, -1170135331, 314479650, 232749338, 19942, -232766458, -314503714, 1170170915, -1073744447, -348360632, 1833003613, -1751253110, -14351, 1751262198, -1832979037, 348332792, 1073738496, -1170134691, 314479202, 232749018, 20642, -232766794, -314504098, 1170171555, -1073744575, -348361112, 1833003997, -1751253110, -14846, 1751262454, -1832978653, 348332344, 1073738432, -1170134051, 314478754, 232748746, 21342, -232767130, -314504546, 1170172067, -1073744703, -348361592, 1833004381, -1751252854, -15341, 1751262582, -1832978269, 348331864, 1073738304, -1170133411, 314478370, 232748426, 22041, -232767386, -314504994, 1170172835, -1073744703, -348362040, 1833004893, -1751252726, -15835, 1751262710, -1832977757, 348331384, 1073738176, -1170132771, 314477922, 232748154, 22741, -232767722, -314505378, 1170173347, -1073744831, -348362552, 1833005277, -1751252598, -16330, 1751262838, -1832977373, 348330904, 1073738112, -1170132259, 314477538, 232747834, 23441, -232767978, -314505826, 1170173987, -1073744959, -348363032, 1833005661, -1751252342, -16825, 1751262966, -1832976989, 348330424, 1073737984, -1170131491, 314477090, 232747498, 24140, -232768314, -314506210, 1170174627, -1073745087, -348363512, 1833006045, -1751252214, -17320, 1751263222, -1832976477, 348329944, 1073737920, -1170130979, 314476642, 232747242, 24840, -232768570, -314506658, 1170175267, -1073745215, -348363960, 1833006557, -1751252086, -17815, 1751263350, -1832976093, 348329464, 1073737792, -1170130339, 314476258, 232746906, 25540, -232768906, -314507106, 1170175907, -1073745215, -348364472, 1833006941, -1751251958, -18310, 1751263478, -1832975709, 348328984, 1073737664, -1170129699, 314475810, 232746650, 26240, -232769226, -314507490, 1170176547, -1073745343, -348364952, 1833007325, -1751251830, -18805, 1751263606, -1832975325, 348328504, 1073737600, -1170129059, 314475426, 232746314, 26939, -232769498, -314507938, 1170177059, -1073745471, -348365432, 1833007837, -1751251574, -19299, 1751263734, -1832974813, 348328024, 1073737472, -1170128419, 314474978, 232746058, 27639, -232769818, -314508322, 1170177827, -1073745599, -348365880, 1833008221, -1751251446, -19794, 1751263990, -1832974429, 348327544, 1073737408, -1170127779, 314474530, 232745722, 28339, -232770090, -314508770, 1170178339, -1073745727, -348366392, 1833008605, -1751251318, -20289, 1751264118, -1832974045, 348327096, 1073737280, -1170127139, 314474146, 232745402, 29039, -232770410, -314509154, 1170178979, -1073745727, -348366872, 1833009117, -1751251190, -20784, 1751264246, -1832973533, 348326584, 1073737152, -1170126627, 314473698, 232745130, 29738, -232770682, -314509602, 1170179619, -1073745855, -348367352, 1833009501, -1751250934, -21279, 1751264374, -1832973149, 348326104, 1073737088, -1170125987, 314473314, 232744810, 30438, -232771002, -314510050, 1170180259, -1073745983, -348367800, 1833009885, -1751250806, -21774, 1751264630, -1832972765, 348325624, 1073736960, -1170125347, 314472866, 232744538, 31138, -232771338, -314510434, 1170180899, -1073746111, -348368312, 1833010269, -1751250678, -22269, 1751264758, -1832972253, 348325176, 1073736896, -1170124707, 314472418, 232744202, 31838, -232771594, -314510882, 1170181539, -1073746239, -348368792, 1833010781, -1751250550, -22764, 1751264886, -1832971869, 348324664, 1073736768, -1170124067, 314472034, 232743946, 32537, -232771930, -314511266, 1170182179, -1073746239, -348369240, 1833011165, -1751250422, -23258, 1751265014, -1832971485, 348324184, 1073736640, -1170123427, 314471586, 232743610, 33237, -232772202, -314511714, 1170182819, -1073746367, -348369720, 1833011549, -1751250166, -23753, 1751265142, -1832971101, 348323704, 1073736576, -1170122787, 314471202, 232743290, 33937, -232772522, -314512162, 1170183331, -1073746495, -348370232, 1833012061, -1751250038, -24248, 1751265398, -1832970589, 348323256, 1073736448, -1170122147, 314470754, 232743018, 34637, -232772794, -314512546, 1170183971, -1073746623, -348370712, 1833012445, -1751249910, -24743, 1751265526, -1832970205, 348322744, 1073736384, -1170121635, 314470306, 232742698, 35336, -232773114, -314512994, 1170184611, -1073746751, -348371160, 1833012829, -1751249782, -25238, 1751265654, -1832969821, 348322264, 1073736256, -1170120995, 314469922, 232742426, 36036, -232773450, -314513378, 1170185251, -1073746751, -348371640, 1833013341, -1751249526, -25733, 1751265782, -1832969309, 348321816, 1073736128, -1170120355, 314469474, 232742106, 36736, -232773706, -314513826, 1170185891, -1073746879, -348372152, 1833013725, -1751249398, -26228, 1751266038, -1832968925, 348321336, 1073736064, -1170119715, 314469090, 232741834, 37436, -232774042, -314514274, 1170186531, -1073747007, -348372632, 1833014109, -1751249270, -26723, 1751266166, -1832968541, 348320824, 1073735936, -1170119075, 314468642, 232741514, 38135, -232774298, -314514658, 1170187171, -1073747135, -348373080, 1833014493, -1751249142, -27217, 1751266294, -1832968029, 348320344, 1073735872, -1170118435, 314468194, 232741178, 38835, -232774634, -314515106, 1170187811, -1073747263, -348373560, 1833015005, -1751249014, -27712, 1751266422, -1832967645, 348319896, 1073735744, -1170117795, 314467810, 232740922, 39535, -232774890, -314515490, 1170188323, -1073747263, -348374072, 1833015389, -1751248758, -28207, 1751266550, -1832967261, 348319416, 1073735616, -1170117155, 314467362, 232740586, 40234, -232775226, -314515938, 1170188963, -1073747391, -348374552, 1833015773, -1751248630, -28702, 1751266806, -1832966877, 348318904, 1073735552, -1170116643, 314466978, 232740330, 40934, -232775546, -314516386, 1170189603, -1073747519, -348375000, 1833016285, -1751248502, -29197, 1751266934, -1832966365, 348318424, 1073735424, -1170116003, 314466530, 232739994, 41634, -232775818, -314516770, 1170190243, -1073747647, -348375480, 1833016669, -1751248374, -29692, 1751267062, -1832965981, 348317976, 1073735360, -1170115363, 314466082, 232739738, 42334, -232776138, -314517218, 1170190883, -1073747775, -348375992, 1833017053, -1751248246, -30187, 1751267318, -1832965597, 348317496, 1073735232, -1170114723, 314465698, 232739402, 43033, -232776410, -314517602, 1170191523, -1073747775, -348376440, 1833017565, -1751247990, -30682, 1751267318, -1832965085, 348316984, 1073735104, -1170114083, 314465250, 232739082, 43733, -232776730, -314518050, 1170192163, -1073747903, -348376920, 1833017949, -1751247862, -31176, 1751267574, -1832964701, 348316504, 1073735040, -1170113443, 314464866, 232738810, 44433, -232777002, -314518498, 1170192675, -1073748031, -348377400, 1833018333, -1751247734};

int main(void)
{
    unsafe {
        dsp_os3_return_code_t return_code = DSP_OS3_NO_ERROR;

        // Input data for both channels
        const int32_t * unsafe input_data[NUM_CHANNELS] = {s1k_0db_16, im4k5k_m6dB_16};

        // OS3 instances variables
        // -----------------------
        // State and Control structures (one per channel)
        int32_t           dsp_os3_delay[NUM_CHANNELS][(DSP_OS3_N_COEFS/DSP_OS3_N_PHASES)<<1];        // Delay line length is 1/3rd of number of coefs as over-sampler by 3 (and double for circular buffer simulation)
        dsp_os3_ctrl_t    dsp_os3_ctrl[NUM_CHANNELS];

        //Init OS3
        for (int i=0; i<NUM_CHANNELS; i++) {

            printf("Init os3 channel %d\n", i);
            // Process init
            // ------------
            // Set delay line base to ctrl structure
            dsp_os3_ctrl[i].delay_base        = (int*)dsp_os3_delay[i];

            // Init instance
            if (dsp_os3_init(&dsp_os3_ctrl[i]) != DSP_OS3_NO_ERROR) {
                printf("Error on init\n");
                return_code = DSP_OS3_ERROR;
            }

            // Sync (i.e. clear data)
            // ----
            if (dsp_os3_sync(&dsp_os3_ctrl[i]) != DSP_OS3_NO_ERROR) {
                printf("Error on sync\n");
                return_code = DSP_OS3_ERROR;
            }

        }

        for (int s=0; s<NUM_OUTPUT_SAMPLES; s++) {
            for (int i=0; i<NUM_CHANNELS; i++) {
                // Run through output samples, we read 1 input sample every 3 output samples
                // This is given when the phase member of the control structure reaches '0'

                // Check if a new input sample is needed
                // If it is needed read it into the control structure and call function to write to delay line
                // If we have reached end of file, signal it.
                if (dsp_os3_ctrl[i].phase == 0) {
                    dsp_os3_ctrl[i].in_data = *input_data[i];
                    //printf("in = %d\n", (int32_t) *input_data[i]);
                    input_data[i]++;

                    if (dsp_os3_input(&dsp_os3_ctrl[i]) != DSP_OS3_NO_ERROR) {
                        printf("Error on os3 input\n");
                        return_code = DSP_OS3_ERROR;
                    }
                }

                // Call sample rate conversion. Always output a sample on each loop
                if (dsp_os3_proc(&dsp_os3_ctrl[i]) != DSP_OS3_NO_ERROR) {
                    printf("Error on os3 process\n");
                    return_code = -4;
                }
                printf("%d\n", dsp_os3_ctrl[i].out_data);
            }
        }
        return (int)return_code;
    }
}
